<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckFlix Lite - Admin Dashboard</title>
    <link rel="stylesheet" href="/static/admin/styles.css?v=18">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <h1>DuckFlix Lite Admin</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <div id="login-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-screen" class="screen">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>DuckFlix Admin</h2>
                <div class="admin-info" id="admin-info"></div>
            </div>
            <ul class="nav-menu">
                <li><a href="#" data-view="dashboard" class="active">Dashboard</a></li>
                <li><a href="#" data-view="users">Users</a></li>
                <li><a href="#" data-view="failures">Playback Failures</a></li>
                <li><a href="#" data-view="health">Service Health</a></li>
                <li><a href="#" data-view="loading-phrases">Loading Phrases</a></li>
                <li><a href="#" data-view="livetv">Live TV</a></li>
                <li><a href="#" data-view="providers">Providers</a></li>
            </ul>
            <button id="logout-btn" class="btn btn-secondary">Logout</button>
        </nav>

        <main class="main-content">
            <!-- Dashboard View -->
            <div id="view-dashboard" class="view active">
                <h1>Dashboard Overview</h1>
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="stat-users">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">RD Keys Expiring Soon</div>
                        <div class="stat-value" id="stat-expiring">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Recent Failures (24h)</div>
                        <div class="stat-value" id="stat-failures">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Services Status</div>
                        <div class="stat-value" id="stat-services">-</div>
                    </div>
                </div>
                <div class="recent-section">
                    <h2>Recent Playback Failures</h2>
                    <div id="recent-failures"></div>
                </div>
            </div>

            <!-- Users View -->
            <div id="view-users" class="view">
                <div class="view-header">
                    <h1>User Management</h1>
                    <button class="btn btn-primary" id="add-user-btn">Add User</button>
                </div>
                <div id="users-table-container"></div>
            </div>

            <!-- Failures View -->
            <div id="view-failures" class="view">
                <h1>Playback Failures</h1>
                <div id="failures-table-container"></div>
            </div>

            <!-- Health View -->
            <div id="view-health" class="view">
                <h1>Service Health</h1>
                <div id="health-status-container"></div>
            </div>

            <!-- Loading Phrases View -->
            <div id="view-loading-phrases" class="view">
                <div class="view-header">
                    <h1>Loading Phrases</h1>
                    <button class="btn btn-primary" id="save-phrases-btn">Save Changes</button>
                </div>
                <div id="loading-phrases-container"></div>
                <div id="scheduled-phrases-container"></div>
            </div>

            <!-- Live TV Channels View -->
            <div id="view-livetv" class="view">
                <div class="view-header">
                    <h1>Live TV Channels</h1>
                    <div class="view-header-actions">
                        <button class="btn btn-secondary" id="seed-logos-btn">Auto-Match Logos</button>
                        <button class="btn btn-secondary" id="reset-sources-btn" title="Reset all channels back to primary source">Reset Sources</button>
                        <button class="btn btn-primary" id="save-channels-btn">Save All Changes</button>
                    </div>
                </div>
                <div class="livetv-toolbar">
                    <input type="text" id="channel-search" placeholder="Search channels..." class="channel-search-input">
                    <div class="livetv-filters">
                        <select id="channel-source-filter">
                            <option value="all">All Sources</option>
                            <option value="tvpass">TVPass</option>
                            <option value="has-ntv">Has NTV</option>
                            <option value="failover">On Failover (not primary)</option>
                            <option value="special">Special</option>
                        </select>
                        <select id="channel-status-filter">
                            <option value="all">All Status</option>
                            <option value="enabled">Enabled</option>
                            <option value="disabled">Disabled</option>
                            <option value="new">New (No Config)</option>
                        </select>
                    </div>
                    <div class="livetv-stats">
                        <span id="channel-stats"></span>
                    </div>
                </div>
                <div id="channels-table-container"></div>
            </div>

            <!-- Providers View -->
            <div id="view-providers" class="view">
                <div id="new-providers-banner" class="alert-banner" style="display:none">
                    <div class="alert-banner-content">
                        <strong>New providers detected!</strong>
                        <span id="new-providers-message"></span>
                    </div>
                    <button class="alert-banner-dismiss" onclick="dismissProviderBanner()">&times;</button>
                </div>
                <div class="view-header">
                    <h1>Streaming Providers</h1>
                    <div class="view-header-actions">
                        <button class="btn btn-primary" id="save-providers-btn">Save All Changes</button>
                    </div>
                </div>
                <div class="providers-toolbar">
                    <input type="text" id="provider-search" placeholder="Search providers..." class="provider-search-input">
                    <div class="providers-filters">
                        <select id="provider-status-filter">
                            <option value="all">All Status</option>
                            <option value="enabled">Enabled</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    <div class="providers-stats">
                        <span id="provider-stats"></span>
                    </div>
                </div>
                <div id="providers-table-container"></div>
            </div>
        </main>
    </div>

    <!-- Modal for User Add/Edit -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="user-modal-title">Add User</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="user-form">
                <input type="hidden" id="user-id" name="id">
                <div class="form-group">
                    <label for="user-username">Username</label>
                    <input type="text" id="user-username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="user-password">Password</label>
                    <input type="password" id="user-password" name="password">
                    <small id="password-hint" style="display: none;">Leave blank to keep current password</small>
                </div>
                <div class="form-group">
                    <label for="user-parent">Parent User (Sub-Account)</label>
                    <select id="user-parent" name="parent_user_id">
                        <option value="">None - Standalone Account</option>
                    </select>
                    <small><i>Sub-accounts inherit parent's RD API key and share IP session</i></small>
                </div>
                <div class="form-group">
                    <label for="user-rd-key">Real-Debrid API Key <span style="color: var(--danger-color);">REQUIRED</span></label>
                    <input type="text" id="user-rd-key" name="rd_api_key" placeholder="Enter RD API key">
                    <small><i>User will be disabled until a valid key is added. Sub-accounts inherit parent's key.</i></small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="user-is-admin" name="is_admin">
                        Admin User
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
                <div id="user-form-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Hidden file inputs for logo uploads -->
    <input type="file" id="logo-upload-input" accept="image/*" style="display:none">
    <input type="file" id="provider-logo-upload-input" accept="image/*" style="display:none">

    <script src="/static/admin/app.js?v=18"></script>
</body>
</html>
